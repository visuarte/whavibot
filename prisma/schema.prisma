// Schema de Prisma para Visuarte Print Shop MVP
// Soporta PostgreSQL (produccion)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Product {
  id           String   @id @default(uuid())
  key          String   @unique
  nombre       String
  descripcion  String?
  tipo         String   // "cantidad_fija" o "por_m2"
  precioPorM2  Float?
  unidad       String
  category     String   // "gran_formato_flexible", "gran_formato_rigido", "peque√±o_formato"
  material     String?  // material principal
  sizeOptions  Json?    // {sizes: ["50x70 cm", "A3"]}
  activo       Boolean  @default(true)
  popular      Boolean  @default(false)
  ordenVisual  Int      @default(0)
  anchoCm      Int?
  altoCm       Int?
  tipoAcabado  String?  // "sin_acabado", "mate", "brillo", "laminado"
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  prices       ProductPrice[]
  options      ProductOption[]
  cotizaciones Cotizacion[]
}

model ProductPrice {
  id          String  @id @default(uuid())
  productId   String
  cantidad    Int
  precioBase  Float
  product     Product @relation(fields: [productId], references: [id])
}

model ProductOption {
  id        String  @id @default(uuid())
  productId String
  name      String  // ej: "1 Tinta", "Laminado Mate"
  recargo   Float   // recargo % o fijo
  product   Product @relation(fields: [productId], references: [id])
}

model Cotizacion {
  id          String   @id @default(uuid())
  productId   String
  cantidad    Int?
  areaM2      Float?
  base        Float
  iva         Float
  total       Float
  leadScoring String   // "tibio" o "caliente"
  optionId    String?
  createdAt   DateTime @default(now())
  product     Product  @relation(fields: [productId], references: [id])
  lead        Lead?    
}

model Lead {
  id             String    @id @default(uuid())
  cotizacionId  String?   @unique
  archivoNombre  String?
  archivoPath    String?
  archivoSize    Int?
  archivoType    String?
  mensaje        String?
  leadScoring   String
  notificado    Boolean   @default(false)
  notificadoAt  DateTime?
  createdAt     DateTime  @default(now())
  cotizacion    Cotizacion? @relation(fields: [cotizacionId], references: [id])
}
